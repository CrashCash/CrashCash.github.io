<html>
  <head>
    <title>Setting up a Raspberry Pi webpage to monitor a Zero motorcycle</title>
    <style type="text/css">
      .home { position: fixed; top: 0px; right: 10px; }
      table {border-collapse: collapse; }
      li { margin-bottom: 10px; }
      code { background:powderblue }
    </style>
  </head>
  <body>
    <a href="https://crashcash.github.io/" class="home">Home</a>
    <h1>Setting up a webpage on a Raspberry Pi to monitor a Zero while it's charging</h1>
    <ul>
      <li>
        Get a Raspberry Pi 3 Model B or newer, plus a good USB charger and cable for power.<br>
        You want a model that has Bluetooth and Ethernet and/or WiFi built-in, because dealing with USB dongles is a hassle. See this
        <a href="https://www.raspberrypi.org/documentation/faqs/#hardware-compare" target="_blank">hardware comparision</a><br>
        You'll want to refer to the
        <a href="https://www.raspberrypi.org/documentation/" target="_blank">raspberrypi.org documentation</a> which is really good.<br>
        Also note that I usually assume you're "root" and I don't mention "su" or "sudo".<br>
        You'll also probably want an HDMI monitor and USB keyboard for initial setup.
      </li><li>
        Put the latest "Raspberry Pi OS Lite" image on an SD card, then put it in the Pi and power it on. Note that some Pis use standard SD
        cards and some use micro SD cards.<br>
        <a href="https://www.raspberrypi.org/software/" target="_blank">Download it from raspberrypi.org</a>
      </li><li>
        Log in using the default user and password of "pi" and "raspberry".
      </li><li>
        Change the default password for the "pi" account using either "raspi-config" under System Options -> Password or the "passwd"
        command.<br>
        <a href="https://www.raspberrypi.org/documentation/configuration/security.md" target="_blank">See the raspberrypi.org
          documentation</a>
      </li><li>
        Set the root password:<br>
        <code>sudo passwd root</code>
      </li><li>
        Enable root login via SSH:<br>
        Delete the /etc/securetty file.<br>
        Edit /etc/ssh/sshd_config and set "PermitRootLogin yes"
      </li><li>
        Enable SSH:<br>
        <code>
          systemctl enable ssh<br>
          systemctl start ssh
        </code>
      </li><li>
        Enable Wi-Fi using "raspi-config" under System Options -> Wireless LAN, or connect your Pi to an Ethernet cable.<br>
        <a href="https://www.raspberrypi.org/documentation/configuration/wireless/wireless-cli.md" target="_blank">See the raspberrypi.org
          documentation</a>
      </li><li>
        Now you should be able to log in from any PC, and no longer need the monitor and keyboard.
      </li><li>
        Set the system timezone:<br>
        <code>dpkg-reconfigure tzdata</code><br>
        For Florida, you'll want to select "America" then "New York"
      </li><li>
        Install latest versions of everything:<br>
        <code>
          apt update<br>
          apt dist-upgrade<br>
          apt --purge autoremove<br>
          apt clean<br>
          reboot<br>
        </code><br>
        You'll probably want to perform this procedure once a month to get security patches and other updates.<br>
        Note when using "apt" that you'll want to do "apt update" to fetch the latest repository info if it's been more than a day since you
        last did so.
      </li><li>
        Get rid of Python 2:<br>
        <code>
          apt purge python2<br>
          apt --purge autoremove<br>
          ln -s /usr/bin/python3 /usr/local/bin/python<br>
          hash -r<br>
        </code>
      </li><li>
        Install Apache webserver, Python Bluetooth library, Python DBUS library, and Bluetooth tools:<br>
        <code>apt install apache2 python3-bluez python3-pydbus bluez-tools libapache2-mod-wsgi-py3 python3-flask</code>
      </li><li>
        Pair with bike:
        <ol>
          <li>
            Put the kickstand down.
          </li><li>
            Turn off the kill switch.
          </li><li>
            Hold down the mode button.
          </li><li>
            Turn on the bike.
          </li><li>
            Wait until the Bluetooth icon flashes. (about 5-10 seconds)
          </li><li>
            Release mode button.
          </li>
        </ol>
        Run "bluetoothctl" and enter the following commands:<br>
        [bluetooth]# <code>discoverable on</code><br>
        Changing discoverable on succeeded<br>
        [CHG] Controller B8:27:EB:C4:1E:75 Discoverable: yes<br>
        [bluetooth]# <code>pairable on</code><br>
        Changing pairable on succeeded<br>
        [bluetooth]# <code>agent on</code><br>
        Agent is already registered<br>
        [bluetooth]# <code>default-agent</code><br>
        Default agent request successful<br>
        [bluetooth]# <code>scan on</code><br>
        Discovery started<br>
        [CHG] Controller B8:27:EB:C4:1E:75 Discovering: yes<br><br>
        Wait until you see something like:<br>
          [NEW] Device 00:06:66:1C:BA:7A ZeroMotorcycles17210<br><br>
        Tell it to pair using the bike's address:<br>
        [bluetooth]# <code>pair 00:06:66:1C:BA:7A<br></code>
        Attempting to pair with 00:06:66:1C:BA:7A<br>
        [CHG] Device 00:06:66:1C:BA:7A Connected: yes<br>
        Request confirmation<br>
        [agent] Confirm passkey 359602 (yes/no): <code>yes</code><br>
        [CHG] Device 00:06:66:1C:BA:7A UUIDs: 00000000-deca-fade-deca-deafdecacaff<br>
        [CHG] Device 00:06:66:1C:BA:7A UUIDs: 00001101-0000-1000-8000-00805f9b34fb<br>
        [CHG] Device 00:06:66:1C:BA:7A ServicesResolved: yes<br>
        [CHG] Device 00:06:66:1C:BA:7A Paired: yes<br>
        Pairing successful<br><br>
        Make it permanent across reboots:<br>
        [bluetooth]# <code>trust 00:06:66:1C:BA:7A</code><br>
        [CHG] Device 00:06:66:1C:BA:7A Trusted: yes<br>
        Changing 00:06:66:1C:BA:7A trust succeeded<br><br>
        Turn off discoverability and exit:<br>
        [bluetooth]# <code>discoverable off</code><br>Changing discoverable off succeeded<br>
        [bluetooth]# <code>quit<br></code><br>
        Now you can turn the bike off.
      </li><li>
        Install Python Zero motorcycle Bluetooth library:<br>
        <code>
          cd /usr/lib/python3/dist-packages<br>
          wget https://raw.githubusercontent.com/CrashCash/ZeroBT/master/zerobt.py
        </code>
      </li>
    </ul>
  </body>
</html>
